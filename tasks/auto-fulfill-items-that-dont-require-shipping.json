{
  "name": "Auto-fulfill items that don't require shipping",
  "options": {
    "wait_until_any_other_shippable_items_are_fulfilled__boolean": null,
    "ignore_products_with_this_tag": null
  },
  "subscriptions": [
    "shopify/orders/paid"
  ],
  "subscriptions_template": "shopify/orders/paid\n{% if options.wait_until_any_other_shippable_items_are_fulfilled__boolean %}\n  shopify/orders/partially_fulfilled\n  shopify/orders/fulfilled\n{% endif %}",
  "script": "{% comment %}\n  Preferred option order:\n\n  {{ options.wait_until_any_other_shippable_items_are_fulfilled__boolean }}\n  {{ options.ignore_products_with_this_tag }}\n{% endcomment %}\n\n{% assign line_items_to_fulfill = array %}\n\n{% if event.preview %}\n  {% capture order_json %}\n    {\n      \"id\": 1234567890,\n      \"line_items\": [\n        {\n          \"id\": 1234567890,\n          \"requires_shipping\": false,\n          \"fulfillment_status\": null\n        },\n        {\n          \"id\": 2345678901,\n          \"requires_shipping\": false,\n          \"fulfillment_status\": null,\n          \"product\": {\n            \"tags\": {{ options.ignore_products_with_this_tag | json }}\n          }\n        },\n        {\n          \"id\": 3456789012,\n          \"requires_shipping\": true,\n          \"fulfillment_status\": \"fulfilled\"\n        },\n        {\n          \"id\": 4567890123,\n          \"requires_shipping\": true,\n          \"fulfillment_status\": \"fulfilled\"\n        }\n      ]\n    }\n  {% endcapture %}\n\n  {% assign order = order_json | parse_json %}\n{% endif %}\n\n{% assign unfulfilled_line_items = array %}\n{% for line_item in order.line_items %}\n  {% if options.ignore_products_with_this_tag != blank %}\n    {% assign line_item_product_tags = line_item.product.tags | split: \", \" %}\n    {% if line_item_product_tags contains options.ignore_products_with_this_tag %}\n      {% continue %}\n    {% endif %}\n  {% endif %}\n\n  {% if line_item.fulfillment_status != \"fulfilled\" %}\n    {% assign unfulfilled_line_items[unfulfilled_line_items.size] = line_item %}\n  {% endif %}\n{% endfor %}\n\n{% assign unfulfilled_line_items_that_require_shipping = unfulfilled_line_items | where: \"requires_shipping\", true %}\n{% assign unfulfilled_line_items_that_do_not_require_shipping = unfulfilled_line_items | where: \"requires_shipping\", false %}\n\n{% if options.wait_until_any_other_shippable_items_are_fulfilled__boolean == false or unfulfilled_line_items_that_require_shipping == empty %}\n  {% for line_item in unfulfilled_line_items_that_do_not_require_shipping %}\n    {% assign fulfillment_line_item = hash %}\n    {% assign fulfillment_line_item[\"id\"] = line_item.id %}\n    {% assign line_items_to_fulfill[line_items_to_fulfill.size] = fulfillment_line_item %}\n  {% endfor %}\n{% endif %}\n\n{% if line_items_to_fulfill != blank %}\n  {% action \"shopify\" %}\n    [\n      \"post\",\n      \"/admin/orders/{{ order.id }}/fulfillments.json\",\n      {\n        \"fulfillment\": {\n          \"location_id\": {{ shop.primary_location_id | json }},\n          \"notify_customer\": false,\n          \"status\": \"success\",\n          \"line_items\": {{ line_items_to_fulfill | json }}\n        }\n      }\n    ]\n  {% endaction %}\n{% endif %}",
  "docs": "Useful for digital products, memberships, or anything else that needs to be fulfilled instantly. This task watches for paid orders, and auto-fulfills all line items that don't require shipping. Optionally, choose to wait until other shippable items are fulfilled, if any.\n\nThis task watches for paid orders, and auto-fulfills all line items that don't require shipping. Optionally, choose to wait until other shippable items are fulfilled, if any.",
  "halt_action_run_sequence_on_error": false,
  "online_store_javascript": null,
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": false
}
