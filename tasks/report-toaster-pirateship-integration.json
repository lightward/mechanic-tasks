{
  "name": "Report Toaster - Pirate Ship Integration",
  "options": {
    "order_name_column__required": "Order ID",
    "order_name_prepend_pound_sign__boolean": true,
    "shipping_cost_column__required": "Cost"
  },
  "subscriptions": [
    "mechanic/emails/received"
  ],
  "subscriptions_template": "mechanic/emails/received",
  "script": "{% comment %}\n  An opinion about option order\n\n  {{ options.order_name_column__required }}\n  {{ options.order_name_prepend_pound_sign__boolean }}\n  {{ options.shipping_cost_column__required }}\n\n{% endcomment %}\n\n{% assign updates = array %}\n\n{% if event.preview %}\n  {% assign update = hash %}\n  {% assign update[\"name\"] = \"#1234\" %}\n  {% assign update[\"shipping_cost\"] = 1.23 %}\n\n  {% assign updates[updates.size] = update %}\n{% else %}\n  {% for attachment in email.attachments %}\n    {% assign shipments = attachment.content | decode_base64 | parse_csv: headers: true %}\n\n    {% for shipment in shipments %}\n      {% assign order_name = shipment[options.order_name_column__required] %}\n      {% assign shipping_cost = shipment[options.shipping_cost_column__required] %}\n\n      {% if order_name != blank %}\n        {% if options.order_name_prepend_pound_sign__boolean %}\n          {% assign order_name = order_name | prepend: \"#\" %}\n        {% endif %}\n\n        {% assign update = hash %}\n        {% assign update[\"name\"] = order_name %}\n        {% assign update[\"shipping_cost\"] = shipping_cost %}\n\n        {% assign updates[updates.size] = update %}\n      {% endif %}\n    {% endfor %}\n  {% endfor %}\n{% endif %}\n\n{% if updates != empty %}\n  {% action \"report_toaster\" %}\n    {\n      \"operation\": \"update\",\n      \"Order\": {{ updates | json }}\n    }\n  {% endaction %}\n{% endif %}",
  "docs": "This task is intended to allow Report Toaster customers to send Pirate Ship export CSV files to Mechanic. These files will then be processed to assign shipping costs to orders.Â \n\nOne or more attachments can be sent and will be processed as long as they meet the following requirements:\n\n1. The order name is included in a column matching the \"Order name column\" option.\n2. If the order name data does not include the # sign and your shop does, use the corresponding option to havee it prepended.\n3. The shipping cost is included in a column matching the \"Shipping cost column\" option.\n\nEach attachment will be parsed and added to an array of updates that will be sent to Report Toaster.",
  "halt_action_run_sequence_on_error": false,
  "online_store_javascript": null,
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": false,
  "tags": [
    "Costs",
    "External API",
    "Integration",
    "Report Toaster",
    "Shipping"
  ]
}
