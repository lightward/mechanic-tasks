{
  "docs": "# Order Tracking with Google Sheets (Demonstration)\n\nThis demonstration task shows you how to use Mechanic's Google Sheets action to track orders. Use this as a learning tool and template for building your own Google Sheets automations!\n\n## What This Demo Shows\n\nLearn how to:\n- Create spreadsheets via the Google Sheets API\n- Append data automatically\n- Export spreadsheets in different formats\n- Handle multiple operation modes\n- Deliver files via email\n\n## Features\n\n- ðŸ“Š Creates a spreadsheet with essential order columns\n- âš¡ Automatically logs new orders as they come in\n- ðŸ“¥ Export options: XLSX, CSV, or PDF\n- ðŸ“§ Email delivery of exports\n\n## What Gets Tracked\n\nEach order entry includes:\n- Order number\n- Date and time\n- Customer name\n- Order total\n- Line items (with quantities)\n- Order status\n\n## Setup Guide\n\n1. **Connect Google Account**\n   - Go to Settings â†’ Authentication\n   - Connect your Google account\n\n2. **Configure Options**\n   - Google account email\n   - Spreadsheet title\n   - Export email address (for downloads)\n   - File format preference (XLSX/CSV/PDF)\n\n3. **Create Your Spreadsheet**\n   - Enable \"Create sheet mode\"\n   - Run the task once\n   - Copy the `spreadsheet_id` from the results\n   - Paste it into the task options\n   - Save the task\n\n4. **Start Tracking**\n   - Disable \"Create sheet mode\"\n   - The task will now automatically track new orders\n\n## Exporting Data\n\nNeed a copy of your data?\n\n1. Enable \"Export sheet mode\"\n2. Choose your preferred format\n3. Verify your email address is set\n4. Run the task\n5. Check your email for the attachment\n\n## Requirements\n\n- Google account connected to Mechanic\n- Valid spreadsheet ID (after initial creation)\n\n## Common Issues\n\n- **\"Spreadsheet ID required\"**: Run in create mode first\n- **\"Mode conflict\"**: Only enable one mode at a time\n- **\"Cannot export\"**: Make sure spreadsheet ID is configured\n- **\"Missing email\"**: Add email address for exports\n\n## Tips\n\n- Create a fresh spreadsheet? Re-enable create mode (delete old ID first)\n- Need regular exports? Set up recurring task runs\n\n## Learning Points\n\nThis demonstration shows several key Google Sheets action features:\n- Creating new spreadsheets with headers\n- Appending rows of data\n- Exporting in multiple formats\n- Error handling\n- Email delivery\n\nUse this task as a reference when building your own Google Sheets automations.",
  "halt_action_run_sequence_on_error": true,
  "name": "Demonstration: Add new orders to a Google Sheet",
  "online_store_javascript": null,
  "options": {
    "google_account__required": "matt@lightward.com",
    "spreadsheet_title__required": "Better order tracking spreadsheet",
    "spreadsheet_id": "",
    "email_address_for_export__email": "matt@lightward.com",
    "file_format_for_export": "pdf",
    "create_sheet_mode__boolean": true,
    "export_sheet_mode__boolean": false
  },
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": true,
  "preview_event_definitions": [],
  "script": "{% comment %}\n  Order Tracking with Google Sheets Integration\n  \n  Features:\n  - Creates a spreadsheet with order tracking columns\n  - Automatically logs new orders \n  - Exports to XLSX, CSV, or PDF formats\n  - Email delivery\n\n  Setup:\n  1. Connect Google account in Settings > Authentication\n  2. Configure spreadsheet title\n  3. Run task to create initial spreadsheet\n  4. Copy spreadsheet_id from results\n  5. Add spreadsheet_id to options\n  6. Toggle between create mode and export mode as needed\n\n  Preferred option order:\n  {{ options.google_account__required }}\n  {{ options.spreadsheet_title__required }}\n  {{ options.spreadsheet_id }}\n  {{ options.email_address_for_export__email }}\n  {{ options.file_format_for_export }}\n  {{ options.create_sheet_mode__boolean }}\n  {{ options.export_sheet_mode__boolean }}\n{% endcomment %}\n\n{% assign order_headers = array %}\n{% assign order_headers[0] = \"Order Number\" %}\n{% assign order_headers[1] = \"Date\" %}\n{% assign order_headers[2] = \"Customer\" %}\n{% assign order_headers[3] = \"Total\" %}\n{% assign order_headers[4] = \"Items\" %}\n{% assign order_headers[5] = \"Status\" %}\n\n{% if event.topic == \"mechanic/user/trigger\" %}\n  {% if options.create_sheet_mode__boolean and options.export_sheet_mode__boolean %}\n    {% error \"Please enable only one mode: either 'Create sheet mode' or 'Export sheet mode', but not both.\" %}\n  {% elsif options.create_sheet_mode__boolean %}\n    {% if options.spreadsheet_id != blank %}\n      {% error \"A spreadsheet ID is already configured. To proceed, either: 1) Uncheck 'Create sheet mode' to just track orders, or 2) Uncheck 'Create sheet mode' and enable 'Export sheet mode' to export the existing spreadsheet.\" %}    \n    {% else %}\n      {% action \"google_sheets\" %}\n        {\n          \"account\": {{ options.google_account__required | json }},\n          \"operation\": \"create_spreadsheet\",\n          \"title\": {{ options.spreadsheet_title__required | json }},\n          \"rows\": [\n            {{ order_headers | json }}\n          ]\n        }\n      {% endaction %}\n    {% endif %}\n  {% elsif options.export_sheet_mode__boolean %}\n    {% if options.spreadsheet_id == blank %}\n      {% error \"Please configure the spreadsheet ID before exporting. First create a spreadsheet using 'Create sheet mode', then copy the spreadsheet ID to the task options.\" %}\n    {% elsif options.email_address_for_export__email == blank %}\n      {% error \"Please provide an email address for export in the task options when using 'Export sheet mode'.\" %}            \n    {% else %}\n      {% assign file_type = \"xlsx\" %}\n      {% assign export_format = options.file_format_for_export | default: \"xlsx\" | downcase %}\n      {% if export_format == \"csv\" %}\n        {% assign file_type = \"csv\" %}\n      {% elsif export_format == \"pdf\" %}\n        {% assign file_type = \"pdf\" %}\n      {% endif %}\n      \n      {% action \"google_sheets\" %}\n        {\n          \"account\": {{ options.google_account__required | json }},\n          \"operation\": \"export_spreadsheet\",\n          \"spreadsheet_id\": {{ options.spreadsheet_id | json }},\n          \"file_type\": {{ file_type | json }}\n        }\n      {% endaction %}\n    {% endif %}\n  {% else %}\n    {% if options.spreadsheet_id != blank %}\n      {% assign message = \"âœ“ Task is configured and actively tracking orders. To export the spreadsheet: 1) Enable 'Export sheet mode', 2) Save the task, then 3) Run the task manually.\" %}\n      {% assign url = \"https://docs.google.com/spreadsheets/d/\" | append: options.spreadsheet_id %}\n      {% log message: message, spreadsheet_url: url %}\n    {% else %}\n      {% log message: \"Please select an action mode in task options: Enable 'Create sheet mode' to create a new spreadsheet, or enable 'Export sheet mode' to export an existing spreadsheet. After creating a spreadsheet, copy its ID to the 'Spreadsheet ID' option.\" %}\n    {% endif %}\n  {% endif %}\n{% endif %}\n\n{% if event.topic == \"mechanic/actions/perform\" %}\n  {% if action.type == \"google_sheets\" and action.run.ok and action.run.result.data_base64 != blank %}\n    {% assign file_extension = \".xlsx\" %}\n    {% assign export_format = options.file_format_for_export | default: \"xlsx\" | downcase %}\n    {% if export_format == \"csv\" %}\n      {% assign file_extension = \".csv\" %}\n    {% elsif export_format == \"pdf\" %}\n      {% assign file_extension = \".pdf\" %}\n    {% endif %}\n\n    {% action \"email\" %}\n      {\n        \"to\": {{ options.email_address_for_export__email | json }},\n        \"subject\": \"Order Tracking Spreadsheet Export\",\n        \"body\": \"Please find attached the requested order tracking data.\",\n        \"attachments\": {\n          {{ action.run.result.name | append: file_extension | json }}: {\n            \"base64\": {{ action.run.result.data_base64 | json }}\n          }\n        }\n      }\n    {% endaction %}\n  {% endif %}\n{% endif %}\n\n{% if event.topic == \"shopify/orders/create\" %}\n  {% if options.spreadsheet_id == blank %}\n    {% error \"Please run this task manually first to create a spreadsheet, then add the spreadsheet_id to the task options.\" %}\n  {% endif %}\n\n  {% comment %}Format order data for spreadsheet{% endcomment %}\n  {% assign order_items = array %}\n  {% for item in order.line_items %}\n    {% assign item_str = item.quantity | append: \"x \" | append: item.title %}\n    {% assign order_items = order_items | push: item_str %}\n  {% endfor %}\n\n  {% assign order_row = array %}\n  {% assign order_row[0] = order.order_number %}\n  {% assign order_row[1] = order.created_at | date: \"%Y-%m-%d %H:%M:%S\" %}\n  {% assign order_row[2] = order.customer.first_name | append: \" \" | append: order.customer.last_name %}\n  {% assign order_row[3] = order.total_price %}\n  {% assign order_row[4] = order_items | join: \", \" %}\n  {% assign order_row[5] = order.financial_status %}\n\n  {% action \"google_sheets\" %}\n    {\n      \"account\": {{ options.google_account__required | json }},\n      \"operation\": \"append_rows\",\n      \"spreadsheet_id\": {{ options.spreadsheet_id | json }},\n      \"rows\": [\n        {{ order_row | json }}\n      ]\n    }\n  {% endaction %}\n{% endif %}",
  "subscriptions": [
    "mechanic/user/trigger",
    "shopify/orders/create",
    "mechanic/actions/perform"
  ],
  "subscriptions_template": "mechanic/user/trigger\nshopify/orders/create\nmechanic/actions/perform\n",
  "tags": [
    "Demonstration",
    "Files",
    "Google Sheets",
    "Orders",
    "Spreadsheets"
  ]
}
