{
  "name": "Demonstration: Shopify Flow integration",
  "options": {
    "customer_id__number": "",
    "order_id__number": "",
    "product_id__number": ""
  },
  "subscriptions": [
    "mechanic/user/trigger",
    "user/flow/customer",
    "user/flow/order",
    "user/flow/product",
    "user/flow/general"
  ],
  "subscriptions_template": "mechanic/user/trigger\nuser/flow/customer\nuser/flow/order\nuser/flow/product\nuser/flow/general",
  "script": "{% comment %} \n  In this example we are showing how to use all four Shopify Flow tiggers:\n  1. General\n  2. Customer\n  3. Order\n  4. Product\n{% endcomment %}\n\n{% assign customer_id = options.customer_id__number %}\n{% assign order_id = options.order_id__number %}\n{% assign product_id = options.product_id__number %}\n\n{% if event.preview or event.topic == \"mechanic/user/trigger\" %}\n\n  {% comment %} \n    Testing the Mechanic customer Flow trigger\n  {% endcomment %}\n\n  {% if customer_id%}\n    {% action \"flow\" %}\n      {\n        {% comment %}\n          If you want your Mechanic Flow trigger to be associated\n          with a Shopify resource, you may include its numeric ID\n          below. Only one resource at a time is supported. Leave\n          this out entirely to use the general Mechanic Flow trigger.\n        {% endcomment %}\n        \"customer_id\": {{ customer_id | json}},\n\n        {% comment %}\n          Keep as many of the following as you like. Any omitted\n          keys *will* be submitted anyway, using the default value\n          given below. If you don't want to use Mechanic's default\n          value, make sure to *keep* the key in place below, setting\n          it to whatever you like.\n        {% endcomment %}\n        \"user_number\":  55,\n        \"user_string\":  \"Love!\"\n      }\n    {% endaction %}\n  {% endif %}\n\n  {% comment %} \n    Testing the Mechanic order Flow trigger\n  {% endcomment %}\n\n  {% if order_id%}\n    {% action \"flow\" %}\n      {\n        {% comment %}\n          If you want your Mechanic Flow trigger to be associated\n          with a Shopify resource, you may include its numeric ID\n          below. Only one resource at a time is supported. Leave\n          this out entirely to use the general Mechanic Flow trigger.\n        {% endcomment %}\n        \"order_id\": {{ order_id | json}},\n\n        {% comment %}\n          Keep as many of the following as you like. Any omitted\n          keys *will* be submitted anyway, using the default value\n          given below. If you don't want to use Mechanic's default\n          value, make sure to *keep* the key in place below, setting\n          it to whatever you like.\n        {% endcomment %}\n        \"user_number\":  55,\n        \"user_string\":  \"Love!\"\n      }\n    {% endaction %}\n  {% endif %}\n\n  {% comment %} \n    Testing the Mechanic product Flow trigger\n  {% endcomment %}\n\n  {% if product_id%}\n    {% action \"flow\" %}\n      {\n        {% comment %}\n          If you want your Mechanic Flow trigger to be associated\n          with a Shopify resource, you may include its numeric ID\n          below. Only one resource at a time is supported. Leave\n          this out entirely to use the general Mechanic Flow trigger.\n        {% endcomment %}\n        \"product_id\": {{ product_id | json}},\n\n        {% comment %}\n          Keep as many of the following as you like. Any omitted\n          keys *will* be submitted anyway, using the default value\n          given below. If you don't want to use Mechanic's default\n          value, make sure to *keep* the key in place below, setting\n          it to whatever you like.\n        {% endcomment %}\n        \"user_number\":  55,\n        \"user_string\":  \"Love!\"\n      }\n    {% endaction %}\n  {% endif %}\n\n  {% comment %} \n    Testing the Mechanic customer Flow trigger\n  {% endcomment %}\n\n  {% action \"flow\" %}\n    {\n      {% comment %}\n        Keep as many of the following as you like. Any omitted\n        keys *will* be submitted anyway, using the default value\n        given below. If you don't want to use Mechanic's default\n        value, make sure to *keep* the key in place below, setting\n        it to whatever you like.\n      {% endcomment %}\n      \"user_boolean\": false,\n      \"user_email\":   \"hey@mechanic.invalid\",\n      \"user_number\":  0,\n      \"user_string\":  \"\",\n      \"user_url\":     \"https://mechanic.invalid/\"\n     }\n  {% endaction %}\n\n{% endif %}\n\n\n{% comment %} \n  Next, we show triggering a Mechanic task from a Flow action.  \n  A few quick points: \n   - This could be in any Mechanic task, we have this example as part of this task for demonstration purposes.\n   - To test this part of the task, you'll need to set up a Shopify Flow to send an action to this event topic.\n{% endcomment %}\n\n{% comment %}\n  The event topic can be anything in the user domain.  We choose user/flow/customer but it could be something like user/flow/xyz\n{% endcomment %}\n\n{% if event.topic == \"user/flow/customer\" %}\n\n{% action \"echo\" %}\n  {\n    \"event\": {{ event.data | parse_json | json}}\n  }\n{% endaction %}\n\n{% endif %}",
  "docs": "This task demonstrates how to use the four Mechanic Shopify Flow triggers: General, Customer, Product, and Order.\n\nYou'll learn about the user-defined data that we can send to Shopify Flow: user_boolean, user_email, user_number, user_string, user_url.\n\nWe demonstrate subscribing to an event topic fired by a Shopify Flow action. You'll need to set up a Flow in the Shopify Flow app to trigger this event topic. This example could be in any Mechanic task; we have this as part of this task for demonstration purposes. The event topic can be anything in the user domain. We choose user/flow/customer, but it could be something like user/flow/xyz.",
  "halt_action_run_sequence_on_error": false,
  "online_store_javascript": null,
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": false,
  "tags": [
    "Demonstration",
    "Integration",
    "Shopify Flow"
  ]
}
