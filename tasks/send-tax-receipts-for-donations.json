{
  "docs": "[to be updated]",
  "halt_action_run_sequence_on_error": false,
  "name": "Send tax receipts for donations",
  "online_store_javascript": null,
  "options": {
    "tax_id__required": "123-ABC",
    "only_include_orders_with_any_of_these_tags__array": null,
    "send_cc_email_to_shop__boolean": true,
    "email_subject__required": "Receipt {{ order.name }} for donation to {{ shop.name }}",
    "email_body__multiline_required": "Thank you for your recent donation!\n\nAttached you will find your official donation receipt.",
    "donation_receipt_filename__required": "{{ shop.name | handleize }}-donation-receipt-{{ order.name  }}.pdf",
    "donation_reciept_html_template__code_multiline_required": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <style>\n    .container {\n      width: 960px;\n      margin: 0 auto;\n      font-size: 16px;\n    }\n    .header {\n      display: flex;\n      flex-direction: row;\n      border-top: 1px solid #000; \n      border-bottom: 1px dashed #000; \n      font-size: 18px;\n    }\n    .main {\n      margin-top: 20px;\n      display: flex;\n      flex-direction: row;\n      font-size: 16px;\n    }\n    .left {\n      width: 50%;\n    }\n    .right {\n      width: 50%;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"header\">\n      <p class=\"left\">\n        {{ shop.name }}<br/>\n        {{ shop.address1 }}<br/>{% if shop.address2 != blank -%}{{ shop.address2 }}<br/>{%- endif %}\n        {{ shop.city }}, {{ shop.province }} {{ shop.zip }}<br/>\n        {{ order.billing_address.country }}\n      </p>\n      <p class=\"right\">\n        OFFICIAL DONATION RECEIPT<br/>\n        TAX ID #[TAX_ID]<br/>\n      </p>\n    </div>\n    <div class=\"main\">\n      <p class=\"left\">\n        <strong>Donor:</strong><br/>\n        {{ order.billing_address.first_name }} {{ billing_address.last_name }}<br/>\n        {{ order.billing_address.address1 }}<br/>{% if order.billing_address.address2 != blank -%}{{ order.billing_address.address2 }}<br/>{%- endif %}\n        {{ order.billing_address.city }}, {{ order.billing_address.province }} {{ order.billing_address.zip }}<br/>\n        {{ order.billing_address.country }}\n      </p>\n      <p class=\"right\">\n        <strong>Donation Details:</strong><br/>\n        Order Number: {{ order.name }}<br/>\n        Donation Received: {{ order.created_at | date: \"%F\" }}<br/>\n        Amount: {{ order.total_price | currency }}<br/>\n        Date Issued: {{ \"now\" | date: \"%F\" }}<br/>\n        Place Issued: {{ shop.province }}, {{ shop.country_name }}<br/>\n        <br/>\n        Donations are tax deductible to the extent permitted by law<br/>\n        <br/>\n        Thank you\n      </p>\n    </div>\n  </div>\n</body>\n</html>"
  },
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": false,
  "preview_event_definitions": [],
  "script": "{% assign tax_id = options.tax_id__required %}\n{% assign order_inclusion_tags = options.only_include_orders_with_any_of_these_tags__array %}\n{% assign cc_shop = options.send_cc_email_to_shop__boolean %}\n{% assign email_subject = options.email_subject__required %}\n{% assign email_body = options.email_body__multiline_required %}\n{% assign donation_receipt_filename = options.donation_receipt_filename__required %}\n{% assign donation_reciept_html_template = options.donation_reciept_html_template__code_multiline_required %}\n\n{% if event.topic == \"shopify/orders/paid\" or event.topic == \"mechanic/user/order\" %}\n  {% comment %}\n    -- NOTE: if this order was sent directly via an admin link, then neither the \"paid\" financial status nor any configured inclusion tags will be checked (on purpose, to allow for merchant flexibility on manual sends)\n  {% endcomment %}\n\n  {% if order.email == blank %}\n    {% log \"This order does not have an email associated with it.\" %}\n    {% break %}\n  {% endif %}\n\n  {% if order_inclusion_tags != blank %}\n    {% assign has_inclusion_tag = nil %}\n    {% assign order_tags = order.tags | split: \", \" %}\n\n    {% for order_tag in order_tags %}\n      {% if order_inclusion_tags contains order_tag %}\n        {% assign has_inclusion_tag = true %}\n        {% break %}\n      {% endif %}\n    {% endfor %}\n\n    {% unless has_inclusion_tag or event.preview %}\n      {% break %}\n    {% endunless %}\n  {% endif %}\n\n  {% action \"email\" %}\n    {\n      \"to\": {{ order.email | json }},\n      \"subject\": {{ email_subject | json }},\n      \"body\": {{ email_body | newline_to_br | json }},\n      {% if cc_shop %}\"cc\": {{ shop.customer_email | json }},{% endif %}\n      \"reply_to\": {{ shop.customer_email | json }},\n      \"from_display_name\": {{ shop.name | json }},\n      \"attachments\": {\n        {{ donation_receipt_filename | remove: \"#\" | json }}: {\n          \"pdf\": {\n            \"html\": {{ donation_reciept_html_template | replace: \"[TAX_ID]\", tax_id | json }},\n            \"__force_pdfcrowd\": true\n          }\n        }\n      }\n    }\n  {% endaction %}\n{% endif %}",
  "subscriptions": ["shopify/orders/paid", "mechanic/user/order"],
  "subscriptions_template": "shopify/orders/paid\nmechanic/user/order"
}
