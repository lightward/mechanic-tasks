{
  "docs": "This task demonstrates how to structure Mechanic Liquid to send and receive the results of a ShopifyQL query. The default query has been adapted from the *Total sales by vendor* report available in Shopify Analytics.\n\nThe task uses a task options field for saving/editing the ShopifyQL query syntax, however, this syntax could be captured directly in the task code instead. Either way, a custom task will need to adapt to the field names returned by that specific ShopifyQL query.\n\n### Want to Learn More?\nReview the [Query analytics data with ShopifyQL](https://learn.mechanic.dev/resources/tutorials/query-analytics-data-with-shopifyql) tutorial for helpful info and development links.",
  "halt_action_run_sequence_on_error": false,
  "name": "Demonstration, Tutorial: Query analytics data with ShopifyQL",
  "online_store_javascript": null,
  "options": {
    "shopifyql_query__multiline_required": "FROM sales\nSHOW net_items_sold, gross_sales, discounts, returns, net_sales, taxes, total_sales\nWHERE product_vendor IS NOT NULL\nGROUP BY product_vendor\nDURING last_year\nORDER BY total_sales DESC"
  },
  "perform_action_runs_in_sequence": false,
  "preview_event_definitions": [],
  "script": "{% assign shopifyql_query = options.shopifyql_query__multiline_required %}\n\n{% capture query %}\n  {\n    shopifyqlQuery(query: {{ shopifyql_query | json }}) {\n      tableData {\n        columns {\n          displayName\n          name\n          dataType\n          subType\n        }\n        rows\n      }\n      parseErrors\n    }\n  }\n{% endcapture %}\n\n{% assign result = query | shopify %}\n\n{% if event.preview %}\n  {% capture result_json %}\n    {\n      \"data\": {\n        \"shopifyqlQuery\": {\n          \"tableData\": {\n            \"columns\": [\n              {\n                \"displayName\": \"Product vendor\",\n                \"name\": \"product_vendor\",\n                \"dataType\": \"STRING\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Net items sold\",\n                \"name\": \"net_items_sold\",\n                \"dataType\": \"INTEGER\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Gross sales\",\n                \"name\": \"gross_sales\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Discounts\",\n                \"name\": \"discounts\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Returns\",\n                \"name\": \"returns\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Net sales\",\n                \"name\": \"net_sales\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Taxes\",\n                \"name\": \"taxes\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              },\n              {\n                \"displayName\": \"Total sales\",\n                \"name\": \"total_sales\",\n                \"dataType\": \"MONEY\",\n                \"subType\": null\n              }\n            ],\n            \"rows\": [\n              {\n                \"product_vendor\": \"ACME\",\n                \"net_items_sold\": \"20\",\n                \"gross_sales\": \"800.0\",\n                \"discounts\": \"0\",\n                \"returns\": \"-24.0\",\n                \"net_sales\": \"776.00\",\n                \"taxes\": \"7.76\",\n                \"total_sales\": \"783.76\"\n              },\n              {\n                \"product_vendor\": \"Company 123\",\n                \"net_items_sold\": \"2\",\n                \"gross_sales\": \"86.55\",\n                \"discounts\": \"-30.25\",\n                \"returns\": \"0\",\n                \"net_sales\": \"56.3\",\n                \"taxes\": \"5.63\",\n                \"total_sales\": \"61.93\"\n              }\n            ]\n          }\n        }\n      }\n    }\n  {% endcapture %}\n\n  {% assign result = result_json | parse_json %}\n{% endif %}\n\n{% assign columns = result.data.shopifyqlQuery.tableData.columns %}\n{% assign rows = result.data.shopifyqlQuery.tableData.rows %}\n\n{% log rows_count: rows.size %}\n{% log rows: rows %}\n{% log columns: columns %}\n",
  "subscriptions": [
    "mechanic/user/trigger"
  ],
  "subscriptions_template": "mechanic/user/trigger",
  "tags": [
    "Analytics",
    "Demonstration",
    "ShopifyQL",
    "Tutorial"
  ]
}
