{
  "name": "Demonstration: Fetch an external configuration file",
  "options": {
    "save_data_to_cache__boolean": null
  },
  "subscriptions": [
    "mechanic/user/trigger",
    "mechanic/actions/perform"
  ],
  "subscriptions_template": "mechanic/user/trigger\nmechanic/actions/perform",
  "script": "{% if event.topic == \"mechanic/user/trigger\" %}\n  {% action \"http\" %}\n    {\n      \"method\": \"get\",\n      \"url\": \"http://example.com/config.txt\"\n    }\n  {% endaction %}\n\n  {% if options.save_data_to_cache__boolean %}\n    {% comment %}\n      For details on reading from the cache, see\n      https://docs.usemechanic.com/article/370-the-cache-object\n    {% endcomment %}\n\n    {% log cached_config: cache.demonstration_config %}\n  {% endif %}\n{% elsif event.topic == \"mechanic/actions/perform\" %}\n  {% if event.preview %}\n    {% comment %}\n      For details on this technique, see\n      https://docs.usemechanic.com/article/335-preview-actions\n    {% endcomment %}\n\n    {% capture action_json %}\n      {\n        \"type\": \"http\",\n        \"run\": {\n          \"result\": {\n            \"body\": \"sample config\"\n          }\n        }\n      }\n    {% endcapture %}\n\n    {% assign action = action_json | parse_json %}\n  {% endif %}\n\n  {% if action.type == \"http\" %}\n    {% assign config = action.run.result.body %}\n\n    {% log retrieved_config: config %}\n\n    {% if options.save_data_to_cache__boolean %}\n      {% action \"cache\", \"set\", \"demonstration_config\", config %}\n    {% endif %}\n  {% endif %}\n{% endif %}",
  "docs": null,
  "halt_action_run_sequence_on_error": false,
  "online_store_javascript": null,
  "order_status_javascript": null,
  "perform_action_runs_in_sequence": false
}
